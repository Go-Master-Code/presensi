<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Karyawan</title>
    <!-- Bootstrap 4 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"/>

    <!-- DataTables Bootstrap 4 -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap4.min.css" />

    <!-- font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />

    <!-- CSS animasi spinner -->
    <style>
    .spinner-logo {
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    /* #table-karyawan {
        table-layout: fixed;
    } */
    </style>
</head>
<body>
    <!-- spinner untuk menunjukkan sistem bekerja saat fetch, delete, create, dan update -->
    <!-- Global Loading Spinner -->
     <!-- Spinner Container -->
    <div id="loadingSpinner" class="d-none position-fixed w-100 h-100" style="top: 0; left: 0; background-color: rgba(255,255,255,0.7); z-index: 2000;">
        <div class="d-flex justify-content-center align-items-center h-100">
            <img src="assets/loading.svg" class="spinner-logo" alt="Loading..." width="80" height="80">
        </div>
    </div>
    
        <!-- ✅ Penjelasan:
            d-none: agar tidak muncul sebelum dipanggil
            position-fixed: agar spinner menutupi seluruh layar
            z-index: harus di atas modal (modal: 1050), jadi pakai 2000
            rgba(255,255,255,0.5): efek overlay semi-transparan
        -->

    <div class="container my-4">
        <!-- ✅ Alert sukses tambah data -->
        <div id="alert-container"></div>

        <h1 class="h1 text-center text-md-center mb-3">Daftar Karyawan</h1>
        <button type="button" class="btn btn-primary mb-3" data-toggle="modal" data-target="#modalKaryawan">
            Tambah Karyawan
        </button>

        <!-- tombol untuk test spinner -->
        <!-- <button class="btn btn-warning" onclick="showSpinner(); setTimeout(hideSpinner, 2000);">Test Spinner</button> -->

        <!-- Modal untuk add data -->
        <div class="modal fade" id="modalKaryawan" tabindex="-1" role="dialog" aria-labelledby="modalKaryawanLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalKaryawanLabel">Data Karyawan Baru</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <!-- modal alert jika gagal tambah data -->
                        <div id="modal-alert" class="w-100 mb-3"></div>

                        <form id="form-karyawan" autocomplete="off">
                            <div class="form-group row">
                                <label for="id" class="col-form-label col-md-4">
                                    ID:<span class="text-danger">*</span>
                                </label>
                                <div class="col-md-8">
                                    <input type="text" class="form-control" id="id" name="id" minlength="10" maxlength="10" required>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="nama" class="col-form-label col-md-4">
                                    Nama:<span class="text-danger">*</span>
                                </label>
                                <div class="col-md-8">
                                    <input type="text" class="form-control" id="nama" name="nama" maxlength="50" required>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="jenjang" class="col-form-label col-md-4">
                                    Jenjang:<span class="text-danger">*</span>
                                </label>
                                <div class="col-md-8">
                                    <select class="custom-select" id="jenjang" name="jenjang" required>
                                        <option selected disabled value="">Pilih jenjang</option>
                                        <!-- option diisi dari js di halaman ini -->
                                    </select>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Save changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal untuk edit data -->
        <div class="modal fade" id="modalEditKaryawan" tabindex="-1" role="dialog" aria-labelledby="modalEditKaryawan" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalKaryawanLabel">Edit Data Karyawan</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="form-edit-karyawan" autocomplete="off">
                            <div class="form-group row">
                                <label for="edit-id" class="col-form-label col-md-4">
                                    ID:<span class="text-danger">*</span>
                                </label>
                                <div class="col-md-8">
                                    <input type="text" class="form-control" id="edit-id" name="edit-id" minlength="10" maxlength="10" disabled>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="edit-nama" class="col-form-label col-md-4">
                                    Nama:<span class="text-danger">*</span>
                                </label>
                                <div class="col-md-8">
                                    <input type="text" class="form-control" id="edit-nama" name="edit-nama" maxlength="50" required>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="edit-jenjang" class="col-form-label col-md-4">
                                    Jenjang:<span class="text-danger">*</span>
                                </label>
                                <div class="col-md-8">
                                    <select class="custom-select" id="edit-jenjang" name="edit-jenjang" required>
                                        <option selected disabled value="">Pilih jenjang</option>
                                        <!-- option diisi dari js di halaman ini -->
                                    </select>
                                </div>
                            </div>
                             <div class="form-group row">
                                <label for="edit-aktif" class="col-form-label col-md-4">
                                    Aktif:<span class="text-danger">*</span>
                                </label>
                                <div class="col-md-8">
                                    <select class="custom-select" id="edit-aktif" name="edit-aktif" required>
                                        <option selected disabled value="">Pilih Status</option>
                                        <option value="true">Aktif</option>
                                        <option value="false">Tidak</option>
                                    </select>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Save changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- alert untuk macam-macam notif misalnya sukses delete -->
        <div id="alert-container"></div>

        <!-- Modal Konfirmasi Hapus -->
        <div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmDeleteLabel">Konfirmasi Hapus</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Tutup">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Apakah Anda yakin ingin menghapus karyawan dengan ID: <span id="deleteIdText" class="font-weight-bold"></span>?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Batal</button>
                    <button type="button" id="btnConfirmDelete" class="btn btn-danger">Hapus</button>
                </div>
                </div>
            </div>
        </div>

        <div class="table-responsive">
            <table id="table-karyawan" class="table table-striped table-bordered table-hover">
                <!-- <caption>List of users</caption> -->
                <thead class="thead-light">
                    <tr>
                        <th style="text-align: center;" scope="col">ID</th>
                        <th scope="col">Nama</th>
                        <th style="text-align: center;" scope="col">Jenjang</th>
                        <th style="text-align: center;" scope="col">Aktif</th>
                        <th style="text-align: center;" scope="col">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- komponen dan data akan dibuat oleh js -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <!-- Popper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap4.min.js"></script>

    <script src="js/api/karyawan.js"></script>

    <!-- mengisi value combobox dari db -->
     <script>
        function createOption(value, text) {
            const option = document.createElement("option");
            option.value = value;
            option.textContent = text;
            return option;
        }

        document.addEventListener("DOMContentLoaded",function() {
            fetch("/api/jenjang")
            .then(response=> response.json()) // ubah ke format json
            .then(data=> {
                const select = document.getElementById("jenjang");
                const editJenjang = document.getElementById("edit-jenjang");
                // const editKelas = document.getElementById("edit-kelas");

                data.data.forEach(jenjang => {
                    const option = document.createElement("option");
                    
                    select.appendChild(createOption(jenjang.id,jenjang.nama));
                    editJenjang.appendChild(createOption(jenjang.id,jenjang.nama));
                    //editKelas.appendChild(createOption(kelas.id,kelas.nama));
                });
            })
            .catch(error=> {
                console.error("Gagal mengambil data jenjang:", error)
            })
        })
     </script>

     <!-- menampilkan alert di modal (sukses / gagal add data karyawan)-->
     <script>
        function showModalAlert(message, type = 'danger', duration = 7000) {
            const alertContainer = document.getElementById('modal-alert');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.role = 'alert';
            alert.innerHTML = `
                ${message}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            `;
            alertContainer.innerHTML = ''; // clear previous
            alertContainer.appendChild(alert);

            setTimeout(() => {
                $(alert).alert('close');
            }, duration);
        }
     </script>

     <!-- menampilkan notif berhasil hapus di halaman utama -->
     <script>
        function showAlert(message, type = 'success', duration = 4000) {
            const alertContainer = document.getElementById('alert-container');

            // Bersihkan alert yang lama (kalau ada)
            alertContainer.innerHTML = '';

            // Buat elemen alert
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.role = 'alert';
            alert.innerHTML = `
                ${message}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            `;

            // Tambahkan ke container
            alertContainer.appendChild(alert);

            // Auto close setelah beberapa detik (duration)
            setTimeout(() => {
                $(alert).alert('close'); // gunakan jQuery Bootstrap alert close
            }, duration);
        }
     </script>

     <!-- spinner -->
     <script>
        function showSpinner() {
            document.getElementById('loadingSpinner').classList.remove('d-none');
        }
        function hideSpinner() {
            document.getElementById('loadingSpinner').classList.add('d-none');
        }
     </script>
</body>
</html>